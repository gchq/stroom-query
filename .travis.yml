# Basic configuration
language: java
jdk: openjdk8

before_script: ./travis.before_script.sh

script: ./travis.script.sh

services:
  - docker

# Push to GitHub releases - the key was generated by the Travis CLI.
deploy:
  - provider: pages
    skip_cleanup: true
    github_token: $GITHUB_TOKEN
    local_dir: build/docs/javadoc/
    target_branch: gh-pages
    on:
      branch: master
  - provider: releases
    api_key:
      # travis encrypt -r gchq/stroom-query <github personal access token>
      secure: "ZmGpSoZooj4qvKBu/64mV2UCZ/f/9HgTy79IhxEWj+sd9VufWM48DrLRqRyNJJQkNJy0JNJaZ7eM9A84Wlu2rXsqaeFIv0709rZ+N5Zssc+0JgHztftLVfiNbDeSN5YZQ8cHajZPouoS5HGc/g22A6/+w/efKteoXHxm8aHWO8LZpjqx5V8CePmyHn/QGtINlares835vFua1KUzfr/hj0G0Tbs6XYAOBylNafreWNH2MnthalCPMe7d4xwoBCYHrO2+tHnH++UrPG2PNVrx7DTwRdUewE5QlVzh4n3Vv8XXHd4t95a49A01X5r+LYGv3gLXU7/fkvLjx6kIXJXthRr4kYh5EJ9z52pjY6QrMxYVbAAbUVcOxjJoBsatBeEclQ8r5Rst29Gjl9ZPE14d00uom977znEUMRuqJ1pXXQ7lYJxD7AHeA/Q5sN8wBnyWHNiic3H5nSegzXF4emNLKL2vqATwNNg6n9XLZ4RZxJ1w4rSIV/r1Se4Zf+Wq5+JreRC+d1uSQHpbKhbr9D0SAW/Shu5cHeHIRA54mPgSejY4p5vfH6B+7g/WdPxKaQKuyYU04PtX0SwjqJu5KLAtp9CwN2oZujDlNGf1D7UnSZrRHqttZQoAFa8m7Ywh35OmJgYDOXQHrDwE2RXeW/C6kD4MlMjnMeCevMCq1/UAwBQ="
    file_glob: true
    file:
      - stroom-query-api/build/libs/stroom-query-api-*.jar
      - stroom-query-common/build/libs/stroom-query-common-*.jar
      - stroom-query-audit/build/libs/stroom-query-audit-*.jar
      - stroom-query-hibernate/build/libs/stroom-query-hibernate-*.jar
      - stroom-query-testing/build/libs/stroom-query-testing-*.jar
    skip_cleanup: true
    on:
      tags: true

# Clean out gradle caches as per travis docs
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
  - .autoconf
  - $HOME/.m2
  - $HOME/.gradle/wrapper
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/
